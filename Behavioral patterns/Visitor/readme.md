## üß≥ –ü–∞—Ç—Ç–µ—Ä–Ω Visitor –Ω–∞ PHP  
_–ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å_

![](https://refactoring.guru/images/patterns/content/visitor/visitor.png)


## üè¢ –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ –∂–∏–∑–Ω–∏
_–£ —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –ø–æ–ª–∏—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π._  

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –Ω–∞—á–∏–Ω–∞—é—â–µ–≥–æ —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞, –∂–∞–∂–¥—É—â–µ–≥–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –û–Ω –±–µ—Å–ø–æ—Ä—è–¥–æ—á–Ω–æ –ø–æ—Å–µ—â–∞–µ—Ç –≤—Å–µ –¥–æ–º–∞ –≤ –æ–∫—Ä—É–≥–µ, –ø—Ä–µ–¥–ª–∞–≥–∞—è —Å–≤–æ–∏ —É—Å–ª—É–≥–∏. –ù–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ –ø–æ—Å–µ—â–∞–µ–º—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–º–æ–≤ —É –Ω–µ–≥–æ –∏–º–µ–µ—Ç—Å—è –æ—Å–æ–±–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.  
* –ü—Ä–∏–¥—è –≤ –¥–æ–º –∫ –æ–±—ã—á–Ω–æ–π —Å–µ–º—å–µ, –æ–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é —Å—Ç—Ä–∞—Ö–æ–≤–∫—É.
* –ü—Ä–∏–¥—è –≤ –±–∞–Ω–∫, –æ–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –æ—Ç –≥—Ä–∞–±–µ–∂–∞.
* –ü—Ä–∏–¥—è –Ω–∞ —Ñ–∞–±—Ä–∏–∫—É, –æ–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è –æ—Ç –ø–æ–∂–∞—Ä–∞ –∏ –Ω–∞–≤–æ–¥–Ω–µ–Ω–∏—è.

## üéØ –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å
- **–ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞–¥ –≤—Å–µ–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —Å–ª–æ–∂–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.** –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–±—ä–µ–∫—Ç–∞–º —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤.
- **–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–µ –∑–∞—Å–æ—Ä—è—è –∫–ª–∞—Å—Å—ã.** –û–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–Ω–æ—Å—è—Ç—Å—è –≤ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è.
- **–ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –Ω–µ –≤—Å–µ–º –∫–ª–∞—Å—Å–∞–º –∏–µ—Ä–∞—Ä—Ö–∏–∏.** –ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –µ–≥–æ —Ç–æ—á–µ—á–Ω–æ.


## üß† –û–ø–∏—Å–∞–Ω–∏–µ

–ü–∞—Ç—Ç–µ—Ä–Ω **Visitor** (**–ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å**) ‚Äî —ç—Ç–æ _**–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π**_ –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫ –≥—Ä—É–ø–ø–µ –æ–±—ä–µ–∫—Ç–æ–≤, –Ω–µ –∏–∑–º–µ–Ω—è—è —Å–∞–º–∏ –æ–±—ä–µ–∫—Ç—ã. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–Ω–µ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã, –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ "–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º–∏", –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±—ä–µ–∫—Ç–∞–º.

## ‚ö° –í –¥–≤—É—Ö —Å–ª–æ–≤–∞—Ö
–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤.

## üß≠ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫ –æ–±—ä–µ–∫—Ç–∞–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Ö –∫–ª–∞—Å—Å–æ–≤.
- –ï—Å—Ç—å —É—Å—Ç–æ–π—á–∏–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤ (—Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è).
- –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –æ–±—ä–µ–∫—Ç–∞–º–∏ —á–∞—Å—Ç–æ –º–µ–Ω—è—é—Ç—Å—è/—Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è.

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏
- –û–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–Ω–æ—Å—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ ¬´–ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏¬ª.
- –û–±—ä–µ–∫—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è —á–µ—Ä–µ–∑ `accept`.
- –ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å –∑–Ω–∞–µ—Ç, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–∞–∂–¥—ã–º —Ç–∏–ø–æ–º –æ–±—ä–µ–∫—Ç–∞.

## üß™ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ PHP

- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Visitor`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –æ–±—ä–µ–∫—Ç–∞–º–∏:
```php
<?php

interface Visitor
{
    public function visitElementA(ElementA $element): void;
    public function visitElementB(ElementB $element): void;
}
```

- ‚úÖ –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π:
```php
<?php

class ElementA {
    public function accept(Visitor $visitor): void
    {
        $visitor->visitElementA($this);
    }

    public function operationA(): void
    {
        echo "ElementA operation\n";
    }
}

class ElementB
{
    public function accept(Visitor $visitor): void
    {
        $visitor->visitElementB($this);
    }

    public function operationB(): void
    {
        echo "ElementB operation\n";
    }
}
```

- ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Visitor`:
```php
<?php

class ConcreteVisitor implements Visitor
{
    public function visitElementA(ElementA $element): void
    {
        echo "ConcreteVisitor is visiting ElementA\n";
        $element->operationA();
    }

    public function visitElementB(ElementB $element): void
    {
        echo "ConcreteVisitor is visiting ElementB\n";
        $element->operationB();
    }
}
```

- ‚úÖ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Visitor –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –æ–±—ä–µ–∫—Ç–∞–º–∏:
```php
<?php

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
$elementA = new ElementA();
$elementB = new ElementB();

$visitor = new ConcreteVisitor();

$elementA->accept($visitor);
// Output:
// ConcreteVisitor is visiting ElementA
// ElementA operation

$elementB->accept($visitor);
// Output:
// ConcreteVisitor is visiting ElementB
// ElementB operation
```

## üß© –ü—Ä–∏–º–µ—Ä –∏–∑ Design Patterns for Humans
_–î–æ–∫—Ç–æ—Ä ¬´–ø–æ—Å–µ—â–∞–µ—Ç¬ª –∂–∏–≤–æ—Ç–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏._

```php
<?php

$monkey = new Monkey();
$lion = new Lion();
$doctor = new Doctor();

$monkey->accept($doctor);
$lion->accept($doctor);
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫ –æ–±—ä–µ–∫—Ç–∞–º, –Ω–µ –∏–∑–º–µ–Ω—è—è —Å–∞–º–∏ –æ–±—ä–µ–∫—Ç—ã.
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ.
- –£–ø—Ä–æ—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤. 
- –ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ–±—Ö–æ–¥–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

## ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É–≤–µ–ª–∏—á–µ–Ω–∏—é —á–∏—Å–ª–∞ –∫–ª–∞—Å—Å–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ, —Ç–∞–∫ –∫–∞–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è.
- –ü–∞—Ç—Ç–µ—Ä–Ω –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω, –µ—Å–ª–∏ –∏–µ—Ä–∞—Ä—Ö–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è.
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∞—Ä—É—à–µ–Ω–∏—é –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
